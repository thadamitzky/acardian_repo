<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>4.5. Code Generator Tools</title><link rel="stylesheet" type="text/css" href="stylesheet.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="home" href="index.html" title="The Foglight Agent Manager Developer's Kit"/><link rel="up" href="ch04.html" title="Chapter 4. Agent Tooling"/><link rel="prev" href="ch04s04.html" title="4.4. FglAM Simulator Builder"/><link rel="next" href="ch05.html" title="Chapter 5. API Compatibility and Upgrades"/><meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.5. Code Generator Tools</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s04.html"><img src="images/prev.png" alt="Prev"/></a> </td><th width="60%" align="center">Chapter 4. Agent Tooling</th><td width="20%" align="right"> <a accesskey="n" href="ch05.html"><img src="images/next.png" alt="Next"/></a></td></tr></table><hr/></div><img align="right" alt="[QUEST Logo]" src="images/quest_logo.gif"/><div class="section" title="4.5. Code Generator Tools"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="codeGenArtifacts"/>4.5. Code Generator Tools</h2></div></div></div><p>
			The Foglight Agent Manager Developer's Kit includes a set of code generation tools that
			assist you in creating the resources that are required to build, deploy, and run 
			your FglAM agents.
		</p><p>
			The code generation tools in this release of the Foglight Agent Manager include:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">Typesafe ASP Property Wrapper (Java source)</li><li class="listitem">Typesafe Topology Data Wrappers (Java source)</li><li class="listitem">Monitoring Policy (XML)</li><li class="listitem">CDT (XML)</li><li class="listitem">Agent Manifest (XML)</li><li class="listitem">Code Generator</li></ul></div><p>
		</p><div class="section" title="4.5.1. Typesafe ASP Property Wrapper"><div class="titlepage"><div><div><h3 class="title"><a id="cgASPWrap"/>4.5.1. Typesafe ASP Property Wrapper</h3></div></div></div><p>
				Each FglAM agent is defined with a group of properties that are
				set within the FglAM package's <span class="emphasis"><em>agent-config.xml</em></span>. These 
				properties are mapped into SPI-based Primary and Secondary ASPs and are
				accessible from the FglAM agents through the <code class="function">ASPService</code>.
			</p><p>
				The <code class="function">ASPService</code> interface provides a non-typesafe set of getters
				and setters for the set of Primary ASPs or individual Secondary ASPs.
				Because the SPID handles all Property values as Java objects, it
				is important to understand the underlying data types of each of the properties
				that you have defined for your agent in order to successfully retrieve
				or set property values.
				As a result, in order to avoid errors, your property accessors code
				must be written in a fairly verbose and defensive manner.
			</p><p>
				Enter the Typesafe ASP Property wrappers generated from the FglAM
				tooling code. When the <code class="function">ASPWrapper</code> parameter 
				is passed to the Code Generator, a typesafe java class containing
				getters and setters is created for each agent property that is defined.
				In addition, special Secondary ASP methods are added that allow
				cloning, perform row additions, and assign lists to the property,
				all in a typesafe manner. 
			</p><p>
				We highly recommend that you use the <code class="function">ASPWrapper</code> class 
				and limit direct access to the <code class="function">ASPService</code> to explicit
				occasions.
			</p></div><div class="section" title="4.5.2. Typesafe Topology Wrappers"><div class="titlepage"><div><div><h3 class="title"><a id="cgTopologyWrappers"/>4.5.2. Typesafe Topology Wrappers</h3></div></div></div><p>
               This set of classes allows the data contained 
               in the topology objects to be submitted to the server quickly and easily.
               These classes are built around the topology types defined for the 
               agent and hide the complexity of the <code class="function">TopologyDataSubmissionService</code> 
               interfaces.	
			</p><p>
               For every topology type specified and referenced in the topology types file
               written by the agent developer, a class (or enum) is generated by the tooling
               that can be used for storing the data collected by the agent and then for submitting 
               it to the server. The generated wrappers allow a hierarchical (tree) data model 
               to be used rather than the more restrictive table-based model required by the
               <code class="function">SpidDataSubmissionService</code>. More information on the potential 
               uses of these generated classes can be found in
               <a class="link" href="ch02s06.html#creating-agents-generatedclasses" title="2.6.5. Generated Topology Classes">Generated Topology Classes</a>. 	
			</p><p>
               For properties that are not observations, but which are marked as "is-many" 
               in the topology definition, an extra method will be generated in addition to the
               standard list retrieval mechanism. This will be called 
               <code class="function">setReplacePropertyName(boolean replace)</code>. If this is called
               with the parameter set to 'true', then the next submission of this list of data will replace,
               as opposed to append to, the list maintained by the server. The default is false
               and the value is reset after every submission. Care should be taken not to invoke
               this method for every submission, because that can cause significant and potentially 
               problematic topology churn on the server.
            </p></div><div class="section" title="4.5.3. Monitoring Policy"><div class="titlepage"><div><div><h3 class="title"><a id="cgMonPol"/>4.5.3. Monitoring Policy</h3></div></div></div><p>
				The Monitoring Policy is an XML file that is included within the
				cartridge (CAR file) and contains the FglAM agents that get deployed
				to the FMS.
				In this release of the FglAM Tooling, the generated 
				<span class="emphasis"><em>monitoring-policy.xml</em></span> contains only the 
				<code class="varname">PersistableConfigModel</code> elements. From 
				an agent developer's perspective, these elements map the 
				properties defined for an agent to an agent property 
				configuration screen on the Administration UI of the FMS.
			</p><p>
				The definitions come from the <span class="emphasis"><em>agent-config.xml</em></span> 
				file. Each agent defines a set of properties that are divided into 
				groups. A group directly translates into
				a section heading on the properties configuration editor of the 
				Admininstation UI. The properties defined within each of the groups 
				contain various attributes that can be set and that affect how the 
				property is rendered in the editor. Attribute rendering can be loosely
				grouped into two types: validation and display.
			</p><p>
				Validation attributes vary depending on the type of property that
				is used. For example, the <code class="function">integer</code> property
				can be defined to require a value that is greater than zero. 
			</p><p>
				Display attributes also vary by property type, but most of the rendering
				characteristics are common throughout all of the property types.
				Display attributes, for example, can set a property to have its
				value encrypted and displayed on the same line as the preceding
				property.
			</p><p>
				The information required to fine tune your agent's
				properties is available in the 
				<a class="ulink" href="../xsd-docs/AgentDefinition/index.html" target="_top">
				Agent Definition XSD
				</a>.
			</p></div><div class="section" title="4.5.4. CDT"><div class="titlepage"><div><div><h3 class="title"><a id="cgCDT"/>4.5.4. CDT</h3></div></div></div><p>
              Canonical Data Transformations (CDT) adapt the raw data provided 
              by agents to topology objects used in the server. The CDTs generated 
              by the tooling convert the data submitted by agents into the topology
              objects used by the server.		
			</p><p>
              Normally, you will not need to customize the CDT generated for your agent. However,
              should the need arise, there are a number of places where you can inject your own XML or
              replace the existing XML. This is done using the <code class="varname">&lt;cdt-fragment/&gt;</code>
              element of the <code class="varname">&lt;topology-types/&gt;</code> in the agent definition file.
              The XML data to be inserted must be well formed. If Groovy scripting is to be 
              included in a CDT fragment, then it must be wrapped in a <code class="function">CDATA</code>
              block.              
            </p><p>
              Here is a section of a generated CDT from the example agent that ships with
              the Developer's Kit. This section contains the part of the CDT for the 
              <code class="function">URLServerInstances</code> topology object
              </p><pre class="programlisting">
&lt;node pattern="URLServerInstance"&gt;
  <a id="before_type"/><img src="images/callouts/1.png" alt="1" border="0"/>
          ..
          ..
          ..
      &lt;node pattern="port"&gt;
      <a id="replace_before"/><img src="images/callouts/2.png" alt="2" border="0"/>
          &lt;value var="$__port_value__"&gt;
              <a id="before_prop"/><img src="images/callouts/3.png" alt="3" border="0"/>
              &lt;attr name="port" target="{{$__node_id__}}" val="{$__port_value__}"/&gt;
              <a id="after_prop"/><img src="images/callouts/4.png" alt="4" border="0"/>
          &lt;/value&gt;
          <a id="replace_after"/><img src="images/callouts/5.png" alt="5" border="0"/>
      &lt;/node&gt;
      <em class="lineannotation"><span class="lineannotation">[ ... other nodes for other properties ]</span></em>
      <a id="after_type"/><img src="images/callouts/6.png" alt="6" border="0"/>
&lt;node/&gt;
              </pre><p>
              </p><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#before_type"><img src="images/callouts/1.png" alt="1" border="0"/></a> </p></td><td valign="top" align="left"><p>
                    This is where we insert custom CDT marked as before a topology node. An example
                    agent definition fragment would be:
                    </p><pre class="programlisting">
<b class="hl-tag" style="color: #3333FF;">&lt;topology-types</b> <span class="hl-attribute" style="color: #993399;">filename</span>=<span class="hl-value" style="color: #993300">"urlavailabilityagent-topology.xml"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;cdt-fragment</b> <span class="hl-attribute" style="color: #993399;">node</span>=<span class="hl-value" style="color: #993300">"URLServerInstance"</span>
                <span class="hl-attribute" style="color: #993399;">location</span>=<span class="hl-value" style="color: #993300">"before"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
      <em class="hl-tag" style="color: green">&lt;!-- This will be inserted at the top of 
           URLServerInstance --&gt;</em>
  <b class="hl-tag" style="color: #3333FF;">&lt;/cdt-fragment&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/topology-types&gt;</b></pre><p>
                  </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#before_prop"><img src="images/callouts/3.png" alt="3" border="0"/></a> </p></td><td valign="top" align="left"><p>This is where we insert custom CDT marked as before a property. An example
                    agent definition fragment would be:
                    </p><pre class="programlisting">
<b class="hl-tag" style="color: #3333FF;">&lt;topology-types</b> <span class="hl-attribute" style="color: #993399;">filename</span>=<span class="hl-value" style="color: #993300">"urlavailabilityagent-topology.xml"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;cdt-fragment</b> <span class="hl-attribute" style="color: #993399;">node</span>=<span class="hl-value" style="color: #993300">"URLServerInstance"</span>
                <span class="hl-attribute" style="color: #993399;">property</span>=<span class="hl-value" style="color: #993300">"port"</span>
                <span class="hl-attribute" style="color: #993399;">location</span>=<span class="hl-value" style="color: #993300">"before"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
      <em class="hl-tag" style="color: green">&lt;!-- This will be inserted at the top of 
           URLServerInstance/port --&gt;</em>
  <b class="hl-tag" style="color: #3333FF;">&lt;/cdt-fragment&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/topology-types&gt;</b></pre><p>
                 </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#after_prop"><img src="images/callouts/4.png" alt="4" border="0"/></a> </p></td><td valign="top" align="left"><p>This is where we insert custom CDT marked as after a property. An example
                    agent definition fragment would be:
                    </p><pre class="programlisting">
<b class="hl-tag" style="color: #3333FF;">&lt;topology-types</b> <span class="hl-attribute" style="color: #993399;">filename</span>=<span class="hl-value" style="color: #993300">"urlavailabilityagent-topology.xml"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;cdt-fragment</b> <span class="hl-attribute" style="color: #993399;">node</span>=<span class="hl-value" style="color: #993300">"UrlServerInstance"</span>
                <span class="hl-attribute" style="color: #993399;">property</span>=<span class="hl-value" style="color: #993300">"port"</span>
                <span class="hl-attribute" style="color: #993399;">location</span>=<span class="hl-value" style="color: #993300">"after"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;/cdt-fragment&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/topology-types&gt;</b></pre><p>
                 </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#after_type"><img src="images/callouts/6.png" alt="6" border="0"/></a> </p></td><td valign="top" align="left"><p>This is where we insert custom CDT marked as after a topology node. An example
                    agent definition fragment would be:
                    </p><pre class="programlisting">
<b class="hl-tag" style="color: #3333FF;">&lt;topology-types</b> <span class="hl-attribute" style="color: #993399;">filename</span>=<span class="hl-value" style="color: #993300">"urlavailabilityagent-topology.xml"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;cdt-fragment</b> <span class="hl-attribute" style="color: #993399;">node</span>=<span class="hl-value" style="color: #993300">"URLServerInstance"</span>
                <span class="hl-attribute" style="color: #993399;">location</span>=<span class="hl-value" style="color: #993300">"after"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
      <em class="hl-tag" style="color: green">&lt;!-- This will be inserted at the bottom of 
           URLServerInstance --&gt;</em>
  <b class="hl-tag" style="color: #3333FF;">&lt;/cdt-fragment&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/topology-types&gt;</b></pre><p>
                  </p></td></tr></table></div><p> 
            </p><p>
              In addition to <code class="varname">before</code> and <code class="varname">after</code>, 
              the <code class="varname">location</code> attribute can be set to <code class="varname">replace</code>.
              When this is set, the provided XML completely replaces all of the generated
              XML. You can do this for a single property or for a generated topology object.
              For example this:
</p><pre class="programlisting">
<b class="hl-tag" style="color: #3333FF;">&lt;topology-types</b> <span class="hl-attribute" style="color: #993399;">filename</span>=<span class="hl-value" style="color: #993300">"urlavailabilityagent-topology.xml"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;cdt-fragment</b> <span class="hl-attribute" style="color: #993399;">node</span>=<span class="hl-value" style="color: #993300">"URLServerInstance"</span>
                <span class="hl-attribute" style="color: #993399;">location</span>=<span class="hl-value" style="color: #993300">"replace"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
      <em class="hl-tag" style="color: green">&lt;!-- This will completely replace the 
           URLServerInstance CDT section --&gt;</em>
      <b class="hl-tag" style="color: #3333FF;">&lt;expression&gt;</b>
        <b class="hl-tag" style="color: #3333FF;">&lt;expr_text&gt;</b>
          <b class="hl-tag" style="color: #3333FF;">&lt;![CDATA[</b>     
          import org.apache.log4j.Logger;
          def LOG = Logger.getLogger("URLAvailabilityAgent-cdtExample");
          LOG.warn("All data for URLServerInstance discarded");
          ]] &gt;
        &lt;/expr_text&gt;
      &lt;/expression&gt;
  &lt;/cdt-fragment&gt;
&lt;/topology-types&gt;</pre><p>
            will replace everything between <span class="emphasis"><em>1</em></span> and <span class="emphasis"><em>6</em></span>
            in the example above. You could replace the generated CDT for a single property 
            with:
</p><pre class="programlisting">
<b class="hl-tag" style="color: #3333FF;">&lt;topology-types</b> <span class="hl-attribute" style="color: #993399;">filename</span>=<span class="hl-value" style="color: #993300">"urlavailabilityagent-topology.xml"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;cdt-fragment</b> <span class="hl-attribute" style="color: #993399;">node</span>=<span class="hl-value" style="color: #993300">"URLServerInstance"</span>
                <span class="hl-attribute" style="color: #993399;">property</span>=<span class="hl-value" style="color: #993300">"port"</span>
                <span class="hl-attribute" style="color: #993399;">location</span>=<span class="hl-value" style="color: #993300">"replace"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
      <em class="hl-tag" style="color: green">&lt;!-- This will completely replace the 
           URLSeverInstance/port CDT section --&gt;</em>
  <b class="hl-tag" style="color: #3333FF;">&lt;/cdt-fragment&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/topology-types&gt;</b></pre><p>
            which will replace everything between <span class="emphasis"><em>2</em></span> and <span class="emphasis"><em>5</em></span>
            in the above example. The CDT fragment is responsible for providing the structure
            required to process the incoming data for the element, in addition to any other
            customization it contains.                          
            </p><p>
              If you want to insert CDT elements that are not associated to a topology definition,
              you can do so by using the special name "root" as the node value in the
              <code class="varname">&lt;cdt-fragment/&gt;</code>. The location can either be "before"
              or "after". "replace" is completely ignored in this case.  
            </p><p>
               node="root" and location="before" will insert the CDT fragment
               immediately before the first topology type section in the generated CDT. 
               node="root" and location="after" will insert the CDT fragment
               after all topology type sections.  
            </p><div class="section" title="4.5.4.1. CDT Abort"><div class="titlepage"><div><div><h4 class="title"><a id="cgCDTCustom"/>4.5.4.1. CDT Abort</h4></div></div></div><p>
                    An agent can have more than one CDT associated with it. This is commonly used to mix data submitted
                    by the generated topology classes and data that is submitted using the topology submission service
                    directly. The server adapter cannot determine which data submission is intended for which CDT,
                    so it sends every data submission to every CDT. Obviously, the CDT has to match the format of the
                    incoming data. To prevent submission errors resulting from sending the wrong data to a CDT,
                    the <code class="varname">&lt;cdt-abort/&gt;</code> customization can be used. This customization is used to indicate
                    that if the CDT receives data it was not written to accept, it should silently stop processing the data.
                    
                    An example agent definition file that uses this might look like the following:
                </p><pre class="programlisting">
<b class="hl-tag" style="color: #3333FF;">&lt;topology-types</b> <span class="hl-attribute" style="color: #993399;">package</span>=<span class="hl-value" style="color: #993300">"com.quest.fglam.example.url.samples"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
    ..
    ..
    <b class="hl-tag" style="color: #3333FF;">&lt;cdt-abort</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"__my_custom_node__"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/topology-types&gt;</b>
                </pre><p>
                    This will cause the generated CDT to include a section that will silently abort (stop processing)
                    the CDT if it receives a data node named <span class="emphasis"><em>__my_custom_node__</em></span>. This allows the cartridge
                    developer to submit this custom node and know that it will not be processed by the generated CDT.
                    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"/></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
                        It is the developer's responsibility to ensure that a second CDT is added to the cartridge that
                        can accept this custom data submission. It should also be noted that this will not prevent
                        errors if a data submission other than one with a top level node named <span class="emphasis"><em>__my_custom_node__</em></span>
                        is processed by the generated CDT.
                    </td></tr></table></div><p>
                </p></div></div><div class="section" title="4.5.5. Agent Manifest"><div class="titlepage"><div><div><h3 class="title"><a id="cgAgentMan"/>4.5.5. Agent Manifest</h3></div></div></div><p>
				The <span class="emphasis"><em>agent.manifest</em></span> is read during the deployment of a GAR. It defines a 
				number of attributes that are used to identify the GAR file contents and describes the contents. 
				For example, it	defines the package name, version, agent types and whether or not they should 
				be run out of process.
			</p><p>
				The <span class="emphasis"><em>agent.manifest</em></span> is stored at the root of the GAR file, but during 
				extraction it is moved to the <span class="emphasis"><em>$AGENT_PACKAGE/$VERSION/config</em></span> directory 
				of the deployment root.
			</p><p>
				During deployment, the DeploymentManager checks whether or not the GAR has been flagged to run out of
				process and also validates the minimum FglAM host version that has
				been declared for hosting the GAR. If there is a version mismatch, the deployment is
				rejected.
			</p><p>
				Once the <span class="emphasis"><em>agent.manifest</em></span> has been validated, the defined agent types are 
				initialized and	made available to FglAM so that new agent instances can be created.
			</p></div><div class="section" title="4.5.6. Running the Code Generator"><div class="titlepage"><div><div><h3 class="title"><a id="runningCodeGenerator"/>4.5.6. Running the Code Generator</h3></div></div></div><p>
				The code generator is called as part of your build process. Once you
				have defined your <span class="emphasis"><em>agent-config.xml</em></span>, the generators take care
				of the rest.
			</p><p>
				The running of the code generator is performed through Ant by importing 
				the <span class="emphasis"><em>fglam-ant-macro.xml</em></span>.
			</p><div class="section" title="4.5.6.1. Ant Task"><div class="titlepage"><div><div><h4 class="title"><a id="antTask"/>4.5.6.1. Ant Task</h4></div></div></div><p>
					An Ant macrodef has been defined to control the artifacts
					that are created through the code generator.
					</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"/></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
						Review the  
						<a class="link" href="ch02s06.html#creating-agent-build-environment" title="2.6.1. Agent Build Environment">
							Agent Build Enviornment
						</a>
						section for details on setting up your Ant build scripts.
					</td></tr></table></div><p>
				</p><p>
					The <code class="varname">fglam:generator</code> Ant macrodef can
					be used to build one, a group, or all of the code generator 
					artifacts.
					We recommend, and default to, running all of the generators in a single pass.
					The following table details the attributes that map to the support generators:
					</p><div class="table"><a id="d0e4175"/><p class="title"><strong>Table 4.2. Foglight Agent Manager Code Generator Ant macrodef</strong></p><div class="table-contents"><table summary="Foglight Agent Manager Code Generator Ant macrodef" border="1"><colgroup><col width="33%"/><col width="33%"/><col width="34%"/></colgroup><thead><tr><th valign="top">Attribute</th><th>Description</th><th align="center" valign="top">Required</th></tr></thead><tbody><tr><td>agent-definition</td><td>This is the path to the <span class="emphasis"><em>agent-definition.xml</em></span> that is used to drive the code generator content.</td><td>Yes</td></tr><tr><td>outputDir</td><td>This sets the directory to which the code generator should save the created artifacts.
										<p>By default, the output is directed to the current working directory.</p>
									</td><td>No</td></tr><tr><td>all</td><td>If <code class="varname">true</code>, all of the available tooling artifacts are generated.
										<p>The default is true.</p>
									</td><td>No</td></tr><tr><td>AgentManifest</td><td>If <code class="varname">true</code>, the FglAM agent manifest is created.
										<p>The default is false.</p>
									</td><td>No</td></tr><tr><td>ASPWrapper</td><td>If <code class="varname">true</code>, a typesafe ASP property wrapper java class is created for each agent defined in the <span class="emphasis"><em>agent-config.xml</em></span>.
										<p>The default is false.</p>
									</td><td>No</td></tr><tr><td>CDT</td><td>If <code class="varname">true</code>, the CDT XML is created for inclusion in the CAR file to be deployed on the FMS.
										<p>The default is false.</p>
									</td><td>No</td></tr><tr><td>MonitoringPolicy</td><td>If <code class="varname">true</code>, the <span class="emphasis"><em>monitoring-policy.xml</em></span> is created for inclusion in the CAR file to be deployed on the FMS.
										<p>The default is false.</p>
									</td><td>No</td></tr><tr><td>TableWrappers</td><td>If <code class="varname">true</code>, the sample dataset java classes are created for each agent.
										<p>The default is false.</p>
									</td><td>No</td></tr><tr><td>Topology</td><td>If <code class="varname">true</code>, the <span class="emphasis"><em>topology.xml</em></span> is created for inclusion in the CAR file to be deployed on the FMS.
										<p>The default is false.</p>
									</td><td>No</td></tr></tbody></table></div></div><p><br class="table-break"/>
				</p><p>
					The following is an example of the <span class="emphasis"><em>generator</em></span> 
					in action:
				</p><p>
					</p><pre class="programlisting"><b class="hl-tag" style="color: #3333FF;">&lt;project</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"URLAvailabilityAgent"</span>
         <span class="hl-attribute" style="color: #993399;">default</span>=<span class="hl-value" style="color: #993300">"dist"</span> <span class="hl-attribute" style="color: #993399;">xmlns:fglam</span>=<span class="hl-value" style="color: #993300">"fglam:/ant/macros"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>

	<em class="hl-tag" style="color: green">&lt;!-- Need a reference to the FglAM DevKit installation --&gt;</em>
	<b class="hl-tag" style="color: #3333FF;">&lt;property</b> <span class="hl-attribute" style="color: #993399;">environment</span>=<span class="hl-value" style="color: #993300">"env"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
	<b class="hl-tag" style="color: #3333FF;">&lt;property</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"fglam.devkit.home"</span> <span class="hl-attribute" style="color: #993399;">value</span>=<span class="hl-value" style="color: #993300">"${env.FGLAM_DEVKIT_HOME}"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
	
	<em class="hl-tag" style="color: green">&lt;!-- Include FglAM Ant MacroDefs --&gt;</em>
	<b class="hl-tag" style="color: #3333FF;">&lt;import</b> <span class="hl-attribute" style="color: #993399;">file</span>=<span class="hl-value" style="color: #993300">"${fglam.devkit.home}/buildtools/fglam-ant-macros.xml"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
...
	<em class="hl-tag" style="color: green">&lt;!-- Default configuration that will run all generators --&gt;</em>
	<b class="hl-tag" style="color: #3333FF;">&lt;target</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"build-all-components"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
		<em class="hl-tag" style="color: green">&lt;!-- build the various FMS deployment files from tooling --&gt;</em>
		<b class="hl-tag" style="color: #3333FF;">&lt;fglam:generator</b> <span class="hl-attribute" style="color: #993399;">agent-definition</span>=<span class="hl-value" style="color: #993300">"${basedir}/config/agent-definition.xml"</span>
			<span class="hl-attribute" style="color: #993399;">outputDir</span>=<span class="hl-value" style="color: #993300">"${build.dir}/tooling"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
	<b class="hl-tag" style="color: #3333FF;">&lt;/target&gt;</b>

	<em class="hl-tag" style="color: green">&lt;!-- Example configuration that only runs the generators 
	     that produce FMS artifacts --&gt;</em>
	<b class="hl-tag" style="color: #3333FF;">&lt;target</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"build-FMS-components"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
		<em class="hl-tag" style="color: green">&lt;!-- build the various FMS deployment files from tooling --&gt;</em>
		<b class="hl-tag" style="color: #3333FF;">&lt;fglam:generator</b> <span class="hl-attribute" style="color: #993399;">agent-definition</span>=<span class="hl-value" style="color: #993300">"${basedir}/config/agent-definition.xml"</span>
			<span class="hl-attribute" style="color: #993399;">outputDir</span>=<span class="hl-value" style="color: #993300">"${build.dir}/tooling"</span>
			<span class="hl-attribute" style="color: #993399;">Topology</span>=<span class="hl-value" style="color: #993300">"true"</span>
			<span class="hl-attribute" style="color: #993399;">MonitoringPolicy</span>=<span class="hl-value" style="color: #993300">"true"</span>
			<span class="hl-attribute" style="color: #993399;">CDT</span>=<span class="hl-value" style="color: #993300">"true"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
	<b class="hl-tag" style="color: #3333FF;">&lt;/target&gt;</b>
...
<b class="hl-tag" style="color: #3333FF;">&lt;/project&gt;</b></pre><p>
				</p></div></div><div class="section" title="4.5.7. Packaging Agents"><div class="titlepage"><div><div><h3 class="title"><a id="creating-agents-packaging"/>4.5.7. Packaging Agents</h3></div></div></div><p>
          In order to deploy your agent, the agent must first be packaged into a GAR file. This compressed archive
		  format contains all of the necessary resources required to run your agent on a FglAM host.
		  The GAR file is added to a CAR file as an installer component. This enables the FMS to deploy the GAR
		  content to any connected FglAM host.
	  </p><p>
		  In addition to the GAR installer component, the remaining tooling artifacts are also added to the
		  CAR file. These include the <span class="emphasis"><em>monitoring-policy.xml</em></span>, <span class="emphasis"><em>CDT.xml</em></span>, and 
		  <span class="emphasis"><em>topology-types.xml</em></span>.
	  </p><p>
		  Look at the FMS Ant CAR task definition to see how to add each of the supported components.
	  </p><div class="section" title="4.5.7.1. GAR Requirements"><div class="titlepage"><div><div><h4 class="title"><a id="agent-packaging-required-layout"/>4.5.7.1. GAR Requirements</h4></div></div></div><p>
              When packaging your agent, there are several files that you need to place in specific
              locations with specific names. If you are using the provided Ant build macros, then
              this is automatically done for you. If you are using your own build system, you need
              to ensure that the following requirements are met:
          </p><p>
              </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Your agent's manifest is in: <span class="emphasis"><em>&lt;agent root&gt;/agent.manifest</em></span></li><li class="listitem">Your agent's jar files are all in <span class="emphasis"><em>&lt;agent root&gt;/lib</em></span></li><li class="listitem">Any remaining files/directories that are required by your agent are added to the root of the GAR archive</li></ol></div><p>
          </p><p>
			  The GAR file format is <span class="emphasis"><em>tar.gz</em></span>. If you need to create GAR files manually, ensure that they
			  have this compressed archive format.
		  </p></div><div class="section" title="4.5.7.2. Packaging Agent in a GAR Format"><div class="titlepage"><div><div><h4 class="title"><a id="agent-packaging-gar"/>4.5.7.2. Packaging Agent in a GAR Format</h4></div></div></div><p>
             The GAR archive format includes all of the client-side agent resources that are required 
             to execute the agent. These files are packaged along with the 
             <a class="link" href="ch02s06.html#creating-agent-definition" title="2.6.4. Agent Definition">Agent Definition</a>. The GAR file is then 
             included as an installer within the cartridge and ready to be deployed to a remote 
             FglAM host.
         </p><p>
			  The creation of the GAR file is handled by the
			  <code class="varname">
				  &lt;fglam:gar agent-manifest="${tooling.output}/agent.manifest"
				  agent-lib-dir ="${build.dir}/jars"/&gt;
			  </code>
              macrodef. Its underlying archive set is based on the <span class="emphasis"><em>tar.gz</em></span> format. By utilizing the
			 <code class="varname">tarfileset</code> task provided by <code class="varname">ANT</code>, the <code class="varname">fglam:gar</code>
			 macro allows the addition of GAR file contents with the ability to define file permission sets
			 at varying levels of granularity.
		 </p><p>
              The following attributes are available when using this task.
              </p><div class="table"><a id="d0e4388"/><p class="title"><strong>Table 4.3. Foglight Agent Manager GAR Generator macrodef</strong></p><div class="table-contents"><table summary="Foglight Agent Manager GAR Generator macrodef" border="1"><colgroup><col width="33%"/><col width="33%"/><col width="34%"/></colgroup><thead><tr><th valign="top">Attribute</th><th>Description</th><th align="center" valign="top">Required</th></tr></thead><tbody><tr><td>agent-manifest</td><td>
                                  This is the path to the agent manifest file for
                                  your FglAM agent project.
                              </td><td>true</td></tr><tr><td>agent-lib-dir</td><td>
                                  This includes all the file contents of the defined <span class="emphasis"><em>lib</em></span> directory.
                              </td><td>true</td></tr><tr><td>build-dir</td><td>
								The GAR macro places the generated GAR file in a child directory of the
								defined <span class="emphasis"><em>build-dir</em></span> value named <span class="emphasis"><em>gar</em></span>.
								<p>
									The default is <span class="emphasis"><em>${build.dir}</em></span>.
								</p>
							</td><td>false</td></tr></tbody></table></div></div><p><br class="table-break"/>
		  </p><p>
			  To include additional GAR file contents (for example, property or resource files that
			  your agent may need during its runtime), the <code class="varname">additional-contents</code> child element 
			  may be used to specify the directory locations of the files you want to include.
		  </p><p>
			  When adding additional contents to your GAR, utilize the <code class="varname">tarfileset</code> task
			  to include files from various directory locations, and define file and directory permissions
			  to be maintained when the GAR is ultimately deployed and extracted.
		  </p><p>
			  The following example adds a properties file and SNMP MIB files to the GAR. Notice the file and
			  directory setting that will be applied to the files when added.
</p><pre class="programlisting"><b class="hl-tag" style="color: #3333FF;">&lt;fglam:gar</b> <span class="hl-attribute" style="color: #993399;">agent-manifest</span>=<span class="hl-value" style="color: #993300">"${tooling.output}/agent.manifest"</span>
           <span class="hl-attribute" style="color: #993399;">agent-lib-dir</span> =<span class="hl-value" style="color: #993300">"${build.dir}/jars"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;additional-contents&gt;</b>
    <b class="hl-tag" style="color: #3333FF;">&lt;tarfileset</b> <span class="hl-attribute" style="color: #993399;">dir</span>=<span class="hl-value" style="color: #993300">"${my.agent.runtime.resource.dir}"</span> 
                <span class="hl-attribute" style="color: #993399;">filemode</span>=<span class="hl-value" style="color: #993300">"644"</span> <span class="hl-attribute" style="color: #993399;">dirmode</span>=<span class="hl-value" style="color: #993300">"755"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
      <b class="hl-tag" style="color: #3333FF;">&lt;include</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"**/*.properties"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
      <b class="hl-tag" style="color: #3333FF;">&lt;include</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"**/*.MIB"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
    <b class="hl-tag" style="color: #3333FF;">&lt;/tarfileset&gt;</b>
  <b class="hl-tag" style="color: #3333FF;">&lt;/additional-contents&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/fglam:gar&gt;</b></pre><p>
          </p><p>
              It is useful to include a <span class="emphasis"><em>dist</em></span> directory in the
              agent's source tree that contains static files like libraries as well as default
              configuration information:
              </p><pre class="programlisting">/path/to/agent/src
    +- src              
    +- test
    +- dist</pre><p>

              The contents of this directory should be laid out as they will appear in the final
              agent distribution (for example, a <span class="emphasis"><em>lib</em></span> subdirectory for third
              party JAR files). An <code class="varname">&lt;additional-contents&gt;</code> element can
              then be used to copy the directory structure verbatim into the final 
              <span class="emphasis"><em>agent.gar</em></span>:
              </p><pre class="programlisting"><b class="hl-tag" style="color: #3333FF;">&lt;additional-contents&gt;</b>
    <b class="hl-tag" style="color: #3333FF;">&lt;tarfileset</b> <span class="hl-attribute" style="color: #993399;">dir</span>=<span class="hl-value" style="color: #993300">"${dist.dir}"</span> <span class="hl-attribute" style="color: #993399;">filemode</span>=<span class="hl-value" style="color: #993300">"644"</span> <span class="hl-attribute" style="color: #993399;">dirmode</span>=<span class="hl-value" style="color: #993300">"755"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
        <b class="hl-tag" style="color: #3333FF;">&lt;include</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"**/*"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
    <b class="hl-tag" style="color: #3333FF;">&lt;/tarfileset&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/additional-contents&gt;</b></pre><p>
              Once complete, any files that are added to the <span class="emphasis"><em>dist</em></span> directory will
              automatically be added to the output GAR file.
            </p></div><div class="section" title="4.5.7.3. Documenting How Metrics Are Gathered"><div class="titlepage"><div><div><h4 class="title"><a id="metric-documentation-gar"/>4.5.7.3. Documenting How Metrics Are Gathered</h4></div></div></div><p>
                It is often useful to provide documentation about how particular metrics are
                gathered. This is important when different methods exist for gathering the same
                or similar metrics. Depending on the tool used, metrics could be gathered in 
                different ways and therefore interpreted in different ways or drawn from slightly 
                different sources and represented similarly. The differences would not be obvious 
                to users, and therefore different states for their system could be interpreted.
            </p><p>
                For instance, a commonly gathered metric is the IO usage of an application. Many
                operating systems attempt to cache file pages in unused memory to improve
                performance. This creates two different IO metrics: application IO and disk IO.
                An application that writes to the same location in a file from within a tight loop 
                generates large amounts of application IO. Due to optimizations in the
                operating system, a majority of those requests simply overwrite a memory resident
                copy of the file. Only when the OS flushes that data to disk is a disk IO
                request generated.
            </p><p>
                In this situation, an agent that collects disk IO presents a vastly different picture from 
                one that collects application IO, and that can be confusing to the user. Documentation on how
                the metrics are collected serves to inform the user about the data they are seeing.
            </p><p>
                To assist you in providing this documation, the FglAM Developer's Kit supports the use of customized
                <code class="varname">@metric</code> JavaDoc tags. These tags are written in a method or member
                variable's source code documentation and can be automatically extracted and formatted using
                the <code class="varname">metric-docgen</code> Ant macro supplied in FglAM's built-in tooling.
            </p><p>
                A metric can also be documented as not being collected by placing the <code class="varname">@{nc}</code> 
                inline marker in the metric's description. A metric that is collected in some 
                cases but not in others can have multiple <code class="varname">@metric</code> JavaDoc tags 
                describing the various scenarios. If not all tags that describe a metric contain 
                the <code class="varname">@{nc}</code> inline element, the metric is considered to be partially 
                collected and the generated documentation will reflect this.                
            </p><p>
                The following example shows a method that has been documented with 
                <code class="varname">@metric</code> tags describing how it collects the <code class="varname">spaceUsed</code>
                metric of the core <code class="varname">LogicalDisk</code> topology type.
            </p><pre class="programlisting">
<em class="hl-tag" style="color: green">/**                
 * This is an example method that determines how much space is being used
 * on a logical storage partition.
 *
 * @metric LogicalDisk.spaceUsed This value is calculated by reading an OS-
 *                               specific value. The value is then converted
 *                               to megabytes before being submitted to the
 *                               topology.
 * @metric LogicalDisk.spaceUsed @{nc} This cannot be collected if the system is a diskless
                                 workstation.
 */</em>
<strong class="hl-keyword">public</strong> <strong class="hl-keyword">void</strong> collectSpaceUsed() {
    <em class="hl-tag" style="color: green">// ...</em>
}</pre><p>
                To generate metric documentation the following target can be used in the agent's
                build script.
            </p><pre class="programlisting">
<b class="hl-tag" style="color: #3333FF;">&lt;import</b> <span class="hl-attribute" style="color: #993399;">file</span>=<span class="hl-value" style="color: #993300">"/path/to/fglam-devkit/buildtools/fglam-ant-macros.xml"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;target</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"metric-docgen"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
    <b class="hl-tag" style="color: #3333FF;">&lt;fglam:metric-docgen</b> <span class="hl-attribute" style="color: #993399;">output-file</span>=<span class="hl-value" style="color: #993300">"/path/to/output.xhtml"</span>
                            <span class="hl-attribute" style="color: #993399;">descriptions</span>=<span class="hl-value" style="color: #993300">"/path/to/metric-descriptions.properties"</span>
                            <span class="hl-attribute" style="color: #993399;">include-unref</span>=<span class="hl-value" style="color: #993300">"true"</span>
                            <span class="hl-attribute" style="color: #993399;">access</span>=<span class="hl-value" style="color: #993300">"private"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
        <b class="hl-tag" style="color: #3333FF;">&lt;source-location&gt;</b>
            <b class="hl-tag" style="color: #3333FF;">&lt;fileset</b> <span class="hl-attribute" style="color: #993399;">dir</span>=<span class="hl-value" style="color: #993300">"/path/to/source/dir"</span><b class="hl-tag" style="color: #3333FF;">&gt;</b>
                <b class="hl-tag" style="color: #3333FF;">&lt;include</b> <span class="hl-attribute" style="color: #993399;">name</span>=<span class="hl-value" style="color: #993300">"**/*.java"</span><b class="hl-tag" style="color: #3333FF;">/&gt;</b>
            <b class="hl-tag" style="color: #3333FF;">&lt;/fileset&gt;</b>
        <b class="hl-tag" style="color: #3333FF;">&lt;/source-location&gt;</b>
    <b class="hl-tag" style="color: #3333FF;">&lt;/fglam:metric-docgen&gt;</b>
<b class="hl-tag" style="color: #3333FF;">&lt;/target&gt;</b>
</pre><p>
                This example scans all the <span class="emphasis"><em>.java</em></span> files contained in the source tree
                for <code class="varname">@metric</code> tags, generates the documentation, and provides the 
                documentation in <span class="emphasis"><em>output.xhtml</em></span>. It uses an additional properties 
                document to provide a higher-level description of what the metric is, as opposed to
                how it is collected. The document is formatted as a simple Java properties
                file, such as:
            </p><pre class="programlisting">
LogicalDisk=The LogicalDisk topology type represents a partition on some physical media.
LogicalDisk.spaceUsed=The amount of space (in megabytes) that is in use on this partition.
</pre><p>
                Separating topology descriptions from the details of how they are gathered
                allows the collection details to be closely tied with the code that gathers
                them without unecessarily cluttering the source code. Additionally, the
                descriptions can be used for multiple invocations of the
                <code class="varname">metric-docgen</code> macro. For example, if the same properties
                are collected across different operating systems, it is possible for
                multiple <code class="varname">@metric</code> tags to be used for each collection type.
                Re-using the description properties file ensures that the topology objects
                themselves are documented correctly for each platform.
            </p><p>
              The <code class="varname">include-unref</code> option to the <code class="varname">metric-docgen</code>
              Ant macro indicates whether or not metrics that are listed in the description file,
              but have no associated <code class="varname">@metric</code> tag, will be included in the
              output. If they are included, then they will be marked as missing metrics and
              their "Obtained By" field will indicate that they are documented, but 
              not collected.
            </p></div></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s04.html"><img src="images/prev.png" alt="Prev"/></a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html"><img src="images/up.png" alt="Up"/></a></td><td width="40%" align="right"> <a accesskey="n" href="ch05.html"><img src="images/next.png" alt="Next"/></a></td></tr><tr><td width="40%" align="left" valign="top">4.4. FglAM Simulator Builder </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"/></a></td><td width="40%" align="right" valign="top"> Chapter 5. API Compatibility and Upgrades</td></tr></table></div></body></html>