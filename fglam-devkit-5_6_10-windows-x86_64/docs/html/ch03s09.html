<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>3.9. AgentResourceService</title><link rel="stylesheet" type="text/css" href="stylesheet.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="home" href="index.html" title="The Foglight Agent Manager Developer's Kit"/><link rel="up" href="ch03.html" title="Chapter 3. Agent Services"/><link rel="prev" href="ch03s08.html" title="3.8. SupportBundleService"/><link rel="next" href="ch03s10.html" title="3.10. ASPService"/><meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8"/></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.9. AgentResourceService</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s08.html"><img src="images/prev.png" alt="Prev"/></a> </td><th width="60%" align="center">Chapter 3. Agent Services</th><td width="20%" align="right"> <a accesskey="n" href="ch03s10.html"><img src="images/next.png" alt="Next"/></a></td></tr></table><hr/></div><img align="right" alt="[QUEST Logo]" src="images/quest_logo.gif"/><div class="section" title="3.9. AgentResourceService"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="agentservices-AgentResourceService"/>3.9. AgentResourceService</h2></div></div></div><p>
			The AgentResourceService gives agents access to change/modify the existing runtime environment. Agents can now
			determine at runtime the various system configuration settings and have them applied the Agent Manager.
		</p><p>
			Whereby the Agent Runtime settings that can be declared within the agent-definition.xml during build time, this
			service provides the same access to resource allocations, but allows the determination of the required resource
			settings to be calculated at runtime based on real-time data
		</p><p>
			Each request method returns a boolean value that will inform the agent whether the resource change is
			currently available or if a restart is needed. An Agent should request all system changes when they are required
			regardless of whether any requests return false. The intent is to have the agent submit its complete resource
			config requirements at once in order to prevent (potential) multiple restarts for each individual request.
		</p><p>
			Should the Agent encounter a resource request that returns false (i.e. a restart is required), then the agent should
			halt any monitoring tasks that require the additional resources. In most instances, this would entail that the agent
			back out of any monitoring tasks and wait for it to be restarted; at which point, it should re-request all resource
			changes under the new settings from the refresh restart in order to validate that all system settings are available.
		</p><p>
			The Service will autodetect whether a request will require a restart of the Agent Manager in order to apply the
			changes, and will schedule the restart to occur at a future date.
		</p><div class="section" title="3.9.1. Using the AgentResourceService"><div class="titlepage"><div><div><h3 class="title"><a id="agentservices-AgentResourceService-example"/>3.9.1. Using the AgentResourceService</h3></div></div></div><p>
				The example code here shows that there is some domain-specific sizing calculation that is done in order
				to determine what increment of additional memory is needed. When the request for memory returns true;
				meaning that the request falls within the current runtime parameters, the agent may continue data
				collection; or alternatively request additional resource types.
			</p><p>
				Should the request for additional resources return false; meaning that the current config cannot
				accommodate this request and that a restart has been scheduled; then the agent code should halt
				monitoring and wait for the restart to occur.
			</p><p>
				</p><pre class="programlisting">
<em class="hl-tag" style="color: green">// Figure out how many objects are being monitored by counting</em>
<em class="hl-tag" style="color: green">// rows in a secondary, or maybe by running an wmi query or something</em>
<strong class="hl-keyword">int</strong> monitoredObjects = aspService.getSecondaryASP(<strong class="hl-string"><em style="color:red">"SecondaryTable"</em></strong>).size();

<em class="hl-tag" style="color: green">// Request an additional 100k of max heap per monitored object</em>
<strong class="hl-keyword">if</strong>(agentResourceService.requestMemorySizeChange(<span class="hl-number">0</span>, monitoredObjects * <span class="hl-number">100</span>)) {
	<em class="hl-tag" style="color: green">// The memory is already available (either because we already</em>
	<em class="hl-tag" style="color: green">// requested the same amount last time the agent started, or our</em>
	<em class="hl-tag" style="color: green">// new request fit into the 10% buffer allocated at startup), so</em>
	<em class="hl-tag" style="color: green">// start monitoring the objects</em>
} <strong class="hl-keyword">else</strong> {
	<em class="hl-tag" style="color: green">// A restart is required. Don't start monitoring just yet.</em>
	<em class="hl-tag" style="color: green">// Log a message that a request for more resources has been made.</em>
}
				</pre><p>
			</p></div></div><div class="navfooter"><hr/><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s08.html"><img src="images/prev.png" alt="Prev"/></a> </td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.png" alt="Up"/></a></td><td width="40%" align="right"> <a accesskey="n" href="ch03s10.html"><img src="images/next.png" alt="Next"/></a></td></tr><tr><td width="40%" align="left" valign="top">3.8. SupportBundleService </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"/></a></td><td width="40%" align="right" valign="top"> 3.10. ASPService</td></tr></table></div></body></html>